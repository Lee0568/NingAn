<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统管理后台 - AdminPanel v2.1</title>
    <style>
        /* CSS 样式保持不变 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f0f2f5; /* 页面背景色 */
            min-height: 100vh;
            color: #333;
            display: flex; /* 使用 flex 布局来排列侧边栏和主内容 */
        }

        /* 侧边栏样式 */
        .sidebar {
            width: 220px; /* 侧边栏固定宽度 */
            background-color: #2c3e50; /* 深色背景 */
            color: #ecf0f1; /* 文字颜色 */
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: sticky; /* 粘性定位，使其在滚动时固定 */
            top: 0; /* 固定在顶部 */
            height: 100vh; /* 撑满整个视口高度 */
            overflow-y: auto; /* 菜单项过多时可滚动 */
        }

        .sidebar-header {
            text-align: center;
            padding-bottom: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 20px;
            font-weight: bold;
            color: #3498db; /* 亮蓝色，作为品牌色 */
        }

        .menu-list {
            list-style: none;
            padding: 0 15px;
        }

        .menu-list li {
            margin-bottom: 5px;
        }

        .menu-list a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: #ecf0f1;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: 15px;
        }

        .menu-list a:hover,
        .menu-list a.active {
            background-color: #34495e; /* 悬停和激活状态的背景色 */
            color: #fff;
        }

        .menu-list a svg {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            fill: currentColor; /* SVG 颜色继承父元素文字颜色 */
        }

        /* 主要内容区域 */
        .main-content-wrapper {
            flex-grow: 1; /* 主内容区域占据剩余所有空间 */
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto; /* 保持内容居中 */
        }

        .header {
            background-color: #fff; /* 白色背景 */
            border-radius: 12px; /* 圆角 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* 柔和的阴影 */
            padding: 20px 30px; /* 内边距 */
            margin-bottom: 20px;
            display: flex;
            flex-direction: column; /* 让标题和状态栏垂直堆叠 */
            align-items: center; /* 让系统标题等元素水平居中 */
        }

        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px; /* 标题与状态栏之间的间距 */
            font-size: 24px; /* 匹配图片中的标题大小 */
            font-weight: bold;
            display: flex; /* 使图标和文字在h1内部水平对齐 */
            align-items: center;
        }

        /* 模拟图标的样式，这里使用SVG数据URI作为占位符 */
        .header h1::before {
            content: '';
            display: inline-block;
            width: 32px; /* 图标大小 */
            height: 32px;
            margin-right: 15px; /* 图标与文字间距 */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233498db'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            vertical-align: middle;
        }

        .status-bar {
            display: flex;
            justify-content: space-between; /* 子元素分散对齐 */
            align-items: center;
            font-size: 14px;
            color: #555; /* 状态栏文字颜色 */
            width: 100%; /* 占据父容器的整个宽度 */
            padding: 0 10px; /* 调整状态栏的内边距，使其与外部对齐 */
        }

        /* 针对状态栏中的具体信息进行样式调整 */
        .status-bar div {
            display: flex; /* 让每个信息块内部元素对齐 */
            align-items: center;
            white-space: nowrap; /* 防止文本换行 */
        }

        .status-bar strong {
            color: #007bff; /* 用户名蓝色 */
        }

        .status-bar span[style*="color: #e74c3c;"] { /* 权限红色 */
            color: #dc3545 !important; /* 统一为之前图片中的红色，并提高优先级 */
            margin-left: 5px;
        }

        /* 模拟在线状态的小圆点 */
        .status-bar #server-status::before {
            content: '●';
            color: #28a745; /* 在线状态绿色 */
            margin-right: 5px;
            font-size: 16px; /* 适当增大圆点大小 */
        }

        /* 简单的内容占位符 */
        .content-placeholder {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-top: 20px;
            min-height: 400px;
            text-align: center;
            font-size: 24px;
            color: #95a5a6;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            body {
                flex-direction: column; /* 小屏幕下侧边栏和主内容垂直堆叠 */
            }

            .sidebar {
                width: 100%; /* 侧边栏全宽 */
                height: auto; /* 高度自适应 */
                position: static; /* 取消粘性定位 */
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            .sidebar-header {
                padding: 15px;
                border-bottom: none;
            }

            .menu-list {
                display: flex;
                flex-wrap: wrap; /* 菜单项允许换行 */
                justify-content: center; /* 菜单项居中 */
                padding: 0 10px;
            }

            .menu-list li {
                margin: 5px; /* 调整间距 */
            }

            .menu-list a {
                padding: 10px 15px;
            }

            .main-content-wrapper {
                padding: 10px;
            }

            .header {
                padding: 15px 20px;
            }

            .status-bar {
                flex-direction: column; /* 状态栏信息垂直堆叠 */
                align-items: flex-start; /* 左对齐 */
                gap: 5px; /* 增加行间距 */
            }
            .status-bar div {
                width: 100%; /* 每条信息占据一行 */
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
<aside class="sidebar">
    <div class="sidebar-header">
        <h2>管理导航</h2>
    </div>
    <ul class="menu-list">
        <li><a href="/admin/dashboard_content.html" class="menu-link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            基础列表
        </a></li>
        <li><a href="/admin/userlist.html" class="menu-link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
            用户管理
        </a></li>
        <li><a href="/admin/command_exec.html" class="menu-link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 1H7c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H7V5h10v14z"/></svg>
            命令执行
        </a></li>
        <li><a href="/admin/sql_query.html" class="menu-link"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm0-4H9V8h2v4zm7-2h-2V8h2v4z"/></svg>
            SQL 查询
        </a></li>
    </ul>
</aside>

<div class="main-content-wrapper">
    <div class="container">
        <div class="header">
            <h1>系统管理后台 <span style="font-size: 18px; font-weight: normal; color: #7f8c8d;">v2.1.3</span></h1>
            <div class="status-bar">
                <div>登录用户: <strong>admin</strong> | 权限: <span style="color: #e74c3c;">超级管理员</span></div>
                <div>服务器状态: <span id="server-status">在线</span></div>
                <div>当前时间: <span id="current-time"></span></div>
            </div>
        </div>

        <div id="main-content-area" class="content-placeholder">
            请选择左侧菜单项以查看内容
        </div>

    </div>
</div>

<script>
    // 获取主要内容区域
    const mainContentArea = document.getElementById('main-content-area');

    // =========== 用户列表页面的相关变量和初始化函数开始 ===========

    // 静态虚拟用户数据（30条）
    const allUsers = [
        { id: 1, username: 'admin', email: 'admin@example.com', role: '超级管理员', regDate: '2023-01-01' },
        { id: 2, username: 'root', email: 'root@localhost', role: '系统管理员', regDate: '2023-01-05' },
        { id: 3, username: 'testuser', email: 'test@example.com', role: '普通用户', regDate: '2023-01-10' },
        { id: 4, username: 'guest', email: 'guest@public.com', role: '访客', regDate: '2023-01-15' },
        { id: 5, username: 'devops', email: 'devops@company.com', role: '开发者', regDate: '2023-01-20' },
        { id: 6, username: 'security_analyst', email: 'sec_analyst@company.com', role: '安全分析师', regDate: '2023-01-25' },
        { id: 7, username: 'network_admin', email: 'net_admin@company.com', role: '网络管理员', regDate: '2023-02-01' },
        { id: 8, username: 'database_user', email: 'db_user@company.com', role: '数据库用户', regDate: '2023-02-05' },
        { id: 9, username: 'marketing_mgr', email: 'marketing@company.com', role: '市场经理', regDate: '2023-02-10' },
        { id: 10, username: 'product_owner', email: 'product@company.com', role: '产品负责人', regDate: '2023-02-15' },
        { id: 11, username: 'sysadmin', email: 'sysadmin@host.com', role: '系统管理员', regDate: '2023-02-20' },
        { id: 12, username: 'webmaster', email: 'webmaster@site.com', role: '网站管理员', regDate: '2023-02-25' },
        { id: 13, username: 'api_user', email: 'api@service.com', role: 'API用户', regDate: '2023-03-01' },
        { id: 14, username: 'backup_user', email: 'backup@storage.com', role: '备份用户', regDate: '2023-03-05' },
        { id: 15, username: 'monitor_agent', email: 'monitor@system.com', role: '监控代理', regDate: '2023-03-10' },
        { id: 16, username: 'report_viewer', email: 'report@analytics.com', role: '报告查看者', regDate: '2023-03-15' },
        { id: 17, username: 'finance_user', email: 'finance@company.com', role: '财务用户', regDate: '2023-03-20' },
        { id: 18, username: 'hr_manager', email: 'hr@company.com', role: '人力资源经理', regDate: '2023-03-25' },
        { id: 19, username: 'legal_advisor', email: 'legal@company.com', role: '法律顾问', regDate: '2023-04-01' },
        { id: 20, username: 'support_engineer', email: 'support@help.com', role: '支持工程师', regDate: '2023-04-05' },
        { id: 21, username: 'editor', email: 'editor@content.com', role: '编辑', regDate: '2023-04-10' },
        { id: 22, username: 'contributor', email: 'contributor@blog.com', role: '贡献者', regDate: '2023-04-15' },
        { id: 23, username: 'analyst', email: 'analyst@data.com', role: '数据分析师', regDate: '2023-04-20' },
        { id: 24, username: 'auditor', email: 'auditor@audit.com', role: '审计员', regDate: '2023-04-25' },
        { id: 25, username: 'super_admin', email: 'super@admin.com', role: '超级管理员', regDate: '2023-05-01' },
        { id: 26, username: 'moderator', email: 'mod@community.com', role: '版主', regDate: '2023-05-05' },
        { id: 27, username: 'power_user', email: 'power@user.com', role: '高级用户', regDate: '2023-05-10' },
        { id: 28, username: 'service_account', email: 'service@automation.com', role: '服务账号', regDate: '2023-05-15' },
        { id: 29, username: 'john_doe', email: 'john.doe@email.com', role: '普通用户', regDate: '2023-05-20' },
        { id: 30, username: 'jane_smith', email: 'jane.smith@email.com', role: '普通用户', regDate: '2023-05-25' }
    ];

    // 这些变量在每次initUserListPage调用时都会重新初始化，
    // 确保了页面的“刷新”行为，符合预期
    let filteredUsers = [];
    const usersPerPage = 10;
    let currentPage = 1;

    // 蜜罐记录函数 (放置在全局，以便所有页面都可以调用)
    async function logHoneypotInteraction(type, data) {
        console.log(`[Honeypot Log] 类型: ${type}, 数据:`, data);
        try {
            // 模拟发送数据到后端，这里使用一个不存在的URL，实际项目中需要替换
            const response = await fetch('/api/log_honeypot_interaction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    type: type,
                    payload: data,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    ip: 'SIMULATED_IP_ADDRESS' // 在实际后端获取
                }),
            });

            if (response.ok) {
                console.log('蜜罐交互数据模拟发送成功！');
            } else {
                console.warn('蜜罐交互数据模拟发送失败，HTTP状态:', response.status);
            }
        } catch (error) {
            console.error('蜜罐交互数据模拟发送请求错误:', error);
        }
    }


    /**
     * 初始化用户列表页面的所有逻辑
     * 在用户列表内容加载到DOM后调用此函数
     */
    function initUserListPage() {
        console.log("初始化用户管理页面...");

        // 每次进入页面时，重置过滤的用户列表和当前页码
        filteredUsers = [...allUsers];
        currentPage = 1;

        // 重新获取DOM元素，因为每次内容加载都会替换这些元素
        const userTableBody = document.getElementById('userTableBody');
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const prevPageButton = document.getElementById('prevPage');
        const nextPageButton = document.getElementById('nextPage');
        const pageInfoSpan = document.getElementById('pageInfo');

        // 确保所有DOM元素都已加载
        if (!userTableBody || !searchInput || !searchButton || !prevPageButton || !nextPageButton || !pageInfoSpan) {
            console.error("用户列表页面关键DOM元素未找到，无法初始化。");
            return;
        }

        // 渲染表格函数
        function renderTable() {
            userTableBody.innerHTML = ''; // 清空表格内容
            const startIndex = (currentPage - 1) * usersPerPage;
            const endIndex = startIndex + usersPerPage;
            const usersToDisplay = filteredUsers.slice(startIndex, endIndex);

            if (usersToDisplay.length === 0) {
                userTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #777; padding: 20px;">没有找到用户。</td></tr>';
            } else {
                usersToDisplay.forEach(user => {
                    const row = userTableBody.insertRow();
                    row.insertCell().textContent = user.id;
                    row.insertCell().textContent = user.username;
                    row.insertCell().textContent = user.email;
                    row.insertCell().textContent = user.role;
                    row.insertCell().textContent = user.regDate;
                });
            }
            updatePaginationControls();
        }

        // 更新分页控件状态
        function updatePaginationControls() {
            const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
            pageInfoSpan.textContent = `第 ${currentPage} / ${totalPages} 页`;
            prevPageButton.disabled = currentPage === 1;
            nextPageButton.disabled = currentPage === totalPages || totalPages === 0;
        }

        // 搜索功能
        function handleSearch() {
            const query = searchInput.value.toLowerCase().trim();
            logHoneypotInteraction('search_query', { query: query }); // 记录搜索操作

            filteredUsers = allUsers.filter(user =>
                user.username.toLowerCase().includes(query) ||
                user.email.toLowerCase().includes(query)
            );
            currentPage = 1; // 搜索后回到第一页
            renderTable();
        }

        // 绑定事件监听器
        // 关键点：每次initUserListPage被调用时，这些事件监听器都会被重新绑定到新加载的DOM元素上
        // 通过 `onclick = null` 或移除旧的事件监听器是可选的，因为旧的DOM元素（及其上的监听器）
        // 在 `mainContentArea.innerHTML = ...` 时已经被移除了。
        searchButton.onclick = null; // 清除之前的绑定（可选，但更安全）
        searchButton.addEventListener('click', handleSearch);

        searchInput.onkeypress = null; // 清除之前的绑定
        searchInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                handleSearch();
            }
        });

        prevPageButton.onclick = null; // 清除之前的绑定
        prevPageButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
                logHoneypotInteraction('pagination', { action: 'prev_page', page: currentPage });
            }
        });

        nextPageButton.onclick = null; // 清除之前的绑定
        nextPageButton.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredUsers.length / usersPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
                logHoneypotInteraction('pagination', { action: 'next_page', page: currentPage });
            }
        });

        // 初始加载：渲染表格
        renderTable();
        // 第一次加载 userlist 页面时，记录页面访问
        logHoneypotInteraction('page_view', { page: 'userlist.html' });
    }
    // =========== 用户列表页面的相关变量和初始化函数结束 ===========


    // 注册一个映射表，将路径映射到初始化函数
    const pageInitializers = {
        '/admin/userlist.html': initUserListPage,
        // 其他页面的初始化函数也可以在这里添加
        // 例如: '/admin/dashboard_content.html': initDashboardPage,
        // '/admin/command_exec.html': initCommandExecPage,
        // '/admin/sql_query.html': initSQLQueryPage,
    };


    // 加载内容的核心函数
    async function loadContent(path, pushState = true) {
        try {
            // 显示加载状态
            mainContentArea.innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">正在加载...</div>';

            const response = await fetch(path);
            if (!response.ok) {
                mainContentArea.innerHTML = `<p style="color: red; font-size: 20px;">无法加载页面: ${path} (HTTP ${response.status})</p>`;
                console.error(`Error loading ${path}: HTTP status ${response.status}`);
                return;
            }
            const fullHtml = await response.text();

            const parser = new DOMParser();
            const doc = parser.parseFromString(fullHtml, 'text/html');
            const contentFragment = doc.getElementById('page-content');

            if (contentFragment) {
                // 只插入内容片段内部的HTML，不再手动解析和执行其中的 <script> 标签
                mainContentArea.innerHTML = contentFragment.innerHTML;

                // 在内容加载并插入DOM后，调用对应的初始化函数
                if (pageInitializers[path]) {
                    pageInitializers[path](); // 调用初始化函数
                } else {
                    // 如果没有特定的初始化函数，可以放置一个默认行为，
                    // 或者什么都不做，对于只包含静态内容的页面这没问题
                    console.log(`没有为 ${path} 找到特定的初始化函数。`);
                }

            } else {
                console.error(`Error: 预期在 ${path} 中找到 id="page-content" 的内容片段，但未找到。`);
                mainContentArea.innerHTML = `<p style="color: red; font-size: 20px;">加载内容失败：内容格式不正确或缺少 'page-content' ID。</p>`;
                return;
            }

            // 更新活跃菜单项
            setActiveLink(path);

            // 更新浏览器URL，但不重新加载页面
            if (pushState) {
                const title = document.title;
                window.history.pushState({ path: path }, title, path);
            }

        } catch (error) {
            console.error('加载内容失败:', error);
            mainContentArea.innerHTML = `<p style="color: red; font-size: 20px;">加载内容失败，请稍后再试或检查控制台。</p>`;
        }
    }

    // 设置活跃菜单项
    function setActiveLink(currentPath) {
        const menuLinks = document.querySelectorAll('.menu-list .menu-link');
        menuLinks.forEach(link => {
            const linkHref = link.getAttribute('href');
            if (currentPath === linkHref) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    // 处理菜单点击事件
    document.addEventListener('DOMContentLoaded', function() {
        const menuLinks = document.querySelectorAll('.menu-list .menu-link');

        menuLinks.forEach(link => {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // 阻止默认的链接跳转行为
                const path = this.getAttribute('href'); // 获取点击链接的 href 属性
                loadContent(path); // 加载新内容
            });
        });

        // 处理浏览器前进/后退按钮
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.path) {
                loadContent(event.state.path, false); // 不再推入新的历史状态
            } else {
                // 如果没有历史状态，默认加载基础列表内容 (这里假设dashboard是默认首页)
                loadContent('/admin/dashboard_content.html', false);
            }
        });

        // 页面首次加载时，根据当前 URL 决定加载哪个内容
        const initialPathname = window.location.pathname;
        if (initialPathname === '/admin/index.html' || initialPathname === '/admin/' || initialPathname === '/') {
            // 初始显示默认提示信息，等待用户点击菜单
            mainContentArea.innerHTML = '<div style="text-align: center; padding: 50px; color: #999; font-size: 18px;">请选择左侧菜单项以查看内容</div>';
        } else {
            // 否则，尝试加载当前 URL 对应的内容片段
            loadContent(initialPathname, false);
        }
    });

    // 更新时间函数
    function updateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = (now.getMonth() + 1).toString().padStart(2, '0');
        const day = now.getDate().toString().padStart(2, '0');
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const seconds = now.getSeconds().toString().padStart(2, '0');
        document.getElementById('current-time').textContent = `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
    }
    setInterval(updateTime, 1000);
    updateTime(); // 立即执行一次，避免页面加载时空白
</script>
</body>
</html>